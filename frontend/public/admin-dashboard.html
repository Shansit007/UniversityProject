<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Admin Dashboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-cover bg-top" style="background-image: url('/img/bg.jpg')"></body>
<body class="bg-gray-100 font-sans">
  <div class="container mx-auto p-6">
    <h1 class="text-3xl font-bold text-center mb-8 text-gray-800">Admin Dashboard</h1>

    <!-- Pending Clubs -->
    <section class="mb-12">
      <h2 class="text-xl font-semibold mb-4">Pending Clubs</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded-lg shadow">
          <thead class="bg-gray-800 text-white rounded-t-lg">
            <tr>
              <th class="py-2 px-4 text-left">Club Name</th>
              <th class="py-2 px-4 text-left">Email</th>
              <th class="py-2 px-4 text-left">President</th>
              <th class="py-2 px-4 text-left">Action</th>
            </tr>
          </thead>
          <tbody id="clubsTable" class="divide-y divide-gray-200">
            <tr><td colspan="4" class="text-center py-4">Loading...</td></tr>
          </tbody>
        </table>
      </div>
    </section>

    <!-- Pending Faculty -->
    <section>
      <h2 class="text-xl font-semibold mb-4">Pending Faculty</h2>
      <div class="overflow-x-auto">
        <table class="min-w-full bg-white rounded-lg shadow">
          <thead class="bg-gray-800 text-white rounded-t-lg">
            <tr>
              <th class="py-2 px-4 text-left">Name</th>
              <th class="py-2 px-4 text-left">Email</th>
              <th class="py-2 px-4 text-left">Faculty ID</th>
              <th class="py-2 px-4 text-left">Action</th>
            </tr>
          </thead>
          <tbody id="facultyTable" class="divide-y divide-gray-200">
            <tr><td colspan="4" class="text-center py-4">Loading...</td></tr>
          </tbody>
        </table>
      </div>
    </section>
  </div>

  <script>
    const backend = "https://where-is-my-faculty-backend.onrender.com";

    // --- Clubs ---
    async function fetchPendingClubs() {
      const res = await fetch(`${backend}/api/club/pending`);
      const data = await res.json();
      const tbody = document.getElementById("clubsTable");
      tbody.innerHTML = "";
      if (!data || data.length === 0) {
        tbody.innerHTML = "<tr><td colspan='4' class='text-center py-4'>No pending clubs</td></tr>";
        return;
      }
      data.forEach(club => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="py-2 px-4">${club.clubName}</td>
          <td class="py-2 px-4">${club.email}</td>
          <td class="py-2 px-4">${club.presidentName}</td>
          <td class="py-2 px-4 flex gap-2">
            <button onclick="approveClub('${club._id}', this)" class="bg-green-500 text-white rounded px-3 py-1 hover:bg-green-600">Approve</button>
            <button onclick="rejectClub('${club._id}', this)" class="bg-red-500 text-white rounded px-3 py-1 hover:bg-red-600">Reject</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function approveClub(id, btn) {
      btn.disabled = true;
      const res = await fetch(`${backend}/api/club/approve/${id}`, { method: "PUT" });
      if (res.ok) {
        alert("Club approved!");
        fetchPendingClubs();
      } else {
        alert("Error approving club");
        btn.disabled = false;
      }
    }

    async function rejectClub(id, btn) {
      btn.disabled = true;
      const res = await fetch(`${backend}/api/club/reject/${id}`, { method: "PUT" });
      if (res.ok) {
        alert("Club rejected!");
        fetchPendingClubs();
      } else {
        alert("Error rejecting club");
        btn.disabled = false;
      }
    }

    // --- Faculty ---
    async function fetchPendingFaculty() {
      const res = await fetch(`${backend}/api/admin/pending`);
      const data = await res.json();
      const tbody = document.getElementById("facultyTable");
      tbody.innerHTML = "";
      if (!data.pendingFaculty || data.pendingFaculty.length === 0) {
        tbody.innerHTML = "<tr><td colspan='4' class='text-center py-4'>No pending faculty</td></tr>";
        return;
      }
      data.pendingFaculty.forEach(fac => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td class="py-2 px-4">${fac.name}</td>
          <td class="py-2 px-4">${fac.email}</td>
          <td class="py-2 px-4">${fac.facultyID}</td>
          <td class="py-2 px-4 flex gap-2">
            <button onclick="approveFaculty('${fac._id}', this)" class="bg-green-500 text-white rounded px-3 py-1 hover:bg-green-600">Approve</button>
            <button onclick="rejectFaculty('${fac._id}', this)" class="bg-red-500 text-white rounded px-3 py-1 hover:bg-red-600">Reject</button>
          </td>
        `;
        tbody.appendChild(tr);
      });
    }

    async function approveFaculty(id, btn) {
  btn.disabled = true;
  const adminToken = localStorage.getItem('adminToken'); // fetch token from storage

  const res = await fetch(`${backend}/api/admin/approve/faculty/${id}`, {
    method: "PUT",
    headers: {
      'Authorization': `Bearer ${adminToken}`,
      'Content-Type': 'application/json'
    }
  });

  const data = await res.json();

  if (res.ok) {
    alert("Faculty approved!");
    fetchPendingFaculty();
  } else {
    alert(data.msg || "Error approving faculty");
    btn.disabled = false;
  }
}


    async function rejectFaculty(id, btn) {
      btn.disabled = true;
      const res = await fetch(`${backend}/api/admin/reject/faculty/${id}`, { method: "PUT" });
      if (res.ok) {
        alert("Faculty rejected!");
        fetchPendingFaculty();
      } else {
        alert("Error rejecting faculty");
        btn.disabled = false;
      }
    }

    // Initial load
    fetchPendingClubs();
    fetchPendingFaculty();
  </script>
</body>
</html>
